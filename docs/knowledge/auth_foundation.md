# 認証基盤とは

## 概要

「あなたは誰か（認証）」「何をしていいか（認可）」を管理する仕組みの総称。
アプリが自前で実装するのではなく、専用のサーバーに委譲することで、複数のアプリで共通の認証を使いまわせる。

## 提供される機能

### 1. 認証（Authentication）— 「あなたは誰か」

- ログイン / ログアウト: ID・パスワードの検証、セッション管理
- ソーシャルログイン: Google・GitHub などで「〇〇でログイン」
- MFA（多要素認証）: SMS・TOTP アプリによる二段階認証
- パスワードリセット: メールによる再設定フロー

### 2. 認可（Authorization）— 「何をしていいか」

- ロール管理: `admin` / `user` など役割の定義と付与
- アクセス制御: ロールに基づいてリソースへのアクセスを許可・拒否
- スコープ: API ごとに「読み取りのみ」「書き込み可」などの権限を設定

### 3. トークン発行（JWT / OAuth2）— 「認証済みの証明書」

認証基盤がトークン（JWT）を発行し、クライアントはそれを持ってバックエンド API を呼ぶ。
バックエンドはトークンを検証して「誰が・何の権限で来たか」を判断する。

```
ログイン成功
    ↓
認証基盤が JWT を発行
    ↓
クライアントはトークンを持って API を呼ぶ
    ↓
バックエンドはトークンを検証してアクセス制御
```

### 4. SSO（シングルサインオン）

一度ログインすれば、複数のアプリに自動的にログインされる仕組み。
認証基盤が「このユーザーはすでにログイン済み」を一元管理するため実現できる。

## 認証基盤がある場合とない場合の比較

**ない場合**: 各アプリが独自にユーザーDB・ログイン処理・パスワードリセットなどを実装・管理する。

**ある場合**: 複数のアプリが一つの認証基盤（Keycloak など）に認証を委譲する。ユーザー管理が一元化され、SSO も実現できる。

## このプロジェクトにおける Keycloak の役割

Keycloak は OSS の認証基盤サーバー。上記の機能をすべて提供する。

```
ブラウザ ──ログイン→ Keycloak ──JWT発行→ ブラウザ
ブラウザ ──JWT付きリクエスト→ Quarkus バックエンド
Quarkus ──JWT検証（Keycloak の公開鍵で署名確認）→ アクセス許可/拒否
```

Quarkus は `quarkus-oidc` 拡張を使って Keycloak と連携する。
JWT の検証はライブラリが自動で行うため、バックエンドは「誰が来たか」の情報を使うだけでよい。

## なぜ自前実装せず認証基盤を使うのか

- パスワードのハッシュ化・保管は実装ミスがセキュリティ事故に直結する
- MFA・ソーシャルログイン・パスワードリセットを正しく実装するコストが高い
- 認証基盤は専門チームが継続的にセキュリティ対応している
- 「認証」と「アプリのビジネスロジック」を分離できる
